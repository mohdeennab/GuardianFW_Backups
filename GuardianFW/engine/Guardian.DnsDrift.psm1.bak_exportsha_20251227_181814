Set-StrictMode -Version Latest

function Get-GfwHostsPath { Join-Path $env:SystemRoot "System32\drivers\etc\hosts" }

function Get-GfwManagedBlockText {
  $hosts = Get-GfwHostsPath
  if(-not (Test-Path $hosts)){ return "" }
  $raw = Get-Content -LiteralPath $hosts -Raw -Encoding ASCII
  $m = [regex]::Match($raw, '(?s)# --- GuardianFW managed entries ---.*?# --- End GuardianFW managed entries ---\s*')
  if($m.Success){ return $m.Value }
  return ""
}

function Get-GfwTextSha256([string]$Text){
  $sha = [System.Security.Cryptography.SHA256]::Create()
  try {
    $bytes = [System.Text.Encoding]::UTF8.GetBytes($Text)
    ($sha.ComputeHash($bytes) | ForEach-Object { $_.ToString("x2") }) -join ""
  } finally { $sha.Dispose() }
}

function Get-GfwManagedBlockHash {
  $t = Get-GfwManagedBlockText
  if([string]::IsNullOrEmpty($t)){ return "" }
  return Get-GfwTextSha256 $t
}

Export-ModuleMember -Function Get-GfwManagedBlockHash,Get-GfwManagedBlockText


# --- EVENTS_PROOF (always runs) ---
try {
  $evDir = "C:\ProgramData\GuardianFW\events"
  New-Item -ItemType Directory -Path $evDir -Force | Out-Null
  $proof = Join-Path $evDir ("proof-{0}.txt" -f (Get-Date -Format "yyyyMMdd-HHmmss"))
  "proof ok at $(Get-Date -Format s)" | Set-Content -LiteralPath $proof -Encoding UTF8 -Force
} catch {}
# --- END EVENTS_PROOF ---

# --- GFW_EVENT_WRITE_MARKERLESS ---
try {
  $evDir = "C:\ProgramData\GuardianFW\events"
  New-Item -ItemType Directory -Path $evDir -Force | Out-Null

  $obj = $null
  if(Get-Variable -Name resultObj -Scope Script -ErrorAction SilentlyContinue){ $obj = $script:resultObj }
  elseif(Get-Variable -Name result -Scope Script -ErrorAction SilentlyContinue){ $obj = [pscustomobject]$script:result }
  else { $obj = [pscustomobject]@{ timestamp=(Get-Date).ToString("s"); status="UNKNOWN" } }

  $eventPath = Join-Path $evDir ("verify-{0}.json" -f (Get-Date -Format "yyyyMMdd-HHmmss"))
  $obj | ConvertTo-Json -Depth 12 | Set-Content -LiteralPath $eventPath -Encoding UTF8 -Force
} catch {
  try {
    New-Item -ItemType Directory -Path "C:\ProgramData\GuardianFW\logs" -Force | Out-Null
    Add-Content -LiteralPath "C:\ProgramData\GuardianFW\logs\verify-integrity.eventwrite.err" `
      -Value ("{0} EVENT_WRITE_FAIL: {1}" -f (Get-Date -Format s), $_.Exception.Message) -Encoding UTF8
  } catch {}
}
# --- END GFW_EVENT_WRITE_MARKERLESS ---


param(
  [string]$Control = "http://127.0.0.1:5052",
  [string]$DeviceName = "Dad-Laptop",
  [string]$Profile = "Kids",
  [int]$Minutes = 30
)

$ErrorActionPreference="Stop"
$here = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location $here

& ".\.venv\Scripts\Activate.ps1"

$env:GUARDIAN_CONTROL = $Control
$env:GUARDIAN_DEVICE_NAME = $DeviceName

# Create pairing code
$pair = irm -Method Post "$Control/admin/pairing/create?profile=$Profile&minutes=$Minutes"
Write-Host ("Pairing code: " + $pair.pairing_code)

$env:GUARDIAN_PAIRING_CODE = $pair.pairing_code

python .\guardian_agent.py
